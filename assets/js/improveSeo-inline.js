jQuery(document).ready(function($) {
    $('.update-project').on('click', function(event) {        
        event.preventDefault(); 
        var projectId = $(this).data('id'); 
        build_project(projectId);
    });
});


function update_project(id) {
    jQuery('.show_loading').css('display', 'block');
    jQuery('.show_loading h1').html('Updating project.... in progress');
    start_update(id);
}
var numm_update;

function start_update(ids) {
    var new_location = improveSeoData.new_location; // Localized new location URL
    var max_iterations = parseInt(jQuery('#max-iterations[data-project=' + ids + ']').val());
    jQuery.ajax({
        url: improveSeoData.ajax_url,  // Accessing localized AJAX URL
        data: {
            action: 'workdex_builder_update_ajax',
            page: 100,
            ajax: 1,
            id: ids
        },
        success: function(data) {
            jQuery('.show_loading h1').html('Updating posts.... in progress');
            jQuery('.show_loading h2').html('Posts generated by now ' + data + '/' + max_iterations);
            if (numm_update == data) {
                jQuery('.show_loading').css('display', 'none');
            } else {
                numm_update = data;
                if (max_iterations < data) {
                    setTimeout(function() { start_update(ids); }, 500);
                }
            }
            if (max_iterations == data) {
                window.location.href = new_location; // Redirect to the new location
            } else {
                location.reload(true);
            }
        }
    });
}

jQuery('#cb-select-all').click(function(e) {
    jQuery('input[type=checkbox]').prop('checked', jQuery(this).prop('checked'));
});
