jQuery(document).ready(function($) {
    $('#build_post').on('click', function(event) {        
        event.preventDefault(); 
        var projectId = $(this).data('project-id'); 
        build_project(projectId);
    });
});

// function build_project(id) {
//     jQuery('.show_loading').css('display', 'block');
//     jQuery('.show_loading h1').html('Building project.... in progress');
//     start_build(id);
// }
// var numm;

// function start_build(ids) {
//     console.log('sdfsd');
//     var max_iterations = parseInt(jQuery('#max-iterations').val());
//     var export_url = improveSeoData.export_url; // Accessing localized export URL

//     jQuery.ajax({
//         url: improveSeoData.ajax_url,  // Accessing localized AJAX URL
//         data: {
//             action: 'workdex_builder_ajax',
//             page: 100,
//             ajax: 1,
//             id: ids
//         },
//         success: function(data) {
//             jQuery('.show_loading h1').html('Building project.... in progress');
//             jQuery('.show_loading h2').html('Posts generated by now ' + data);
//             var is_preview_available = jQuery('#is_preview_available').val();
//             if (max_iterations > 100) {
//                 if (numm == data) {
//                     jQuery('.show_loading').css('display', 'none');
//                     if (is_preview_available == 'yes') {
//                         window.location.href = export_url + ids + '&noheader=true';
//                     }
//                 } else {
//                     numm = data;
//                     setTimeout(function() { start_build(ids); }, 100);
//                 }
//                 location.reload(true);
//             } else {
//                 if (is_preview_available == 'yes') {
//                     jQuery('.show_loading h1').html('Exporting posts. Please wait');
//                     jQuery('.show_loading h2').html('');
//                     window.location.href = export_url + ids + '&noheader=true';
//                 } else {
//                     setTimeout(function() {
//                         jQuery('.show_loading').css('display', 'none');
//                         location.reload(true);
//                     }, 100);
//                 }
//             }
//         }
//     });
// }

function update_project(id) {
    jQuery('.show_loading').css('display', 'block');
    jQuery('.show_loading h1').html('Updating project.... in progress');
    start_update(id);
}
var numm_update;

function start_update(ids) {
    var new_location = improveSeoData.new_location; // Localized new location URL
    var max_iterations = parseInt(jQuery('#max-iterations[data-project=' + ids + ']').val());
    jQuery.ajax({
        url: improveSeoData.ajax_url,  // Accessing localized AJAX URL
        data: {
            action: 'workdex_builder_update_ajax',
            page: 100,
            ajax: 1,
            id: ids
        },
        success: function(data) {
            jQuery('.show_loading h1').html('Updating posts.... in progress');
            jQuery('.show_loading h2').html('Posts generated by now ' + data + '/' + max_iterations);
            if (numm_update == data) {
                jQuery('.show_loading').css('display', 'none');
            } else {
                numm_update = data;
                if (max_iterations < data) {
                    setTimeout(function() { start_update(ids); }, 500);
                }
            }
            if (max_iterations == data) {
                window.location.href = new_location; // Redirect to the new location
            } else {
                location.reload(true);
            }
        }
    });
}

jQuery('#cb-select-all').click(function(e) {
    jQuery('input[type=checkbox]').prop('checked', jQuery(this).prop('checked'));
});
